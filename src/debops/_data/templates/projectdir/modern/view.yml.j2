---
{# Copyright (C) 2023 Maciej Delmanowski <drybjed@gmail.com>
 # Copyright (C) 2023 DebOps <https://debops.org/>
 # SPDX-License-Identifier: GPL-3.0-or-later
 #}
# Configuration for the '{{ view_name }}' view

views:
  {{ view_name }}:

    # List of Ansible Collections in which DebOps will search for playbooks
    # when this infrastructure view is used.
    playbook_collections:
      - 'debops.debops'

    # Configuration options for Ansible, will be included in the 'ansible.cfg'
    # file generated by DebOps.
    # Ref: https://docs.ansible.com/ansible/latest/reference_appendices/config.html
    ansible:

      defaults:

        # Path to the default Ansible inventory directory managed in the DebOps project
        # directory. It is relative to the 'ansible.cfg' configuration file.
        # Use comma to specify multiple inventories ('inventory,../<view>/inventory').
        inventory: '{{ env["ANSIBLE_INVENTORY"] | d("inventory") }}'

        # String which will be set as the "ansible_managed" variable in templates
        # generated by Ansible.
        ansible_managed: '{{ env["ANSIBLE_MANAGED"] | d("This file is managed remotely, all changes will be lost") }}'

        # List of directories which contain Ansible Collections, separated by
        # colons. The first directory found will be used by the
        # 'ansible-galaxy' command to install collections.
        collections_path: '{{ env["ANSIBLE_COLLECTIONS_PATH"] | d("${DEBOPS_PROJECT_PATH}/ansible/collections:~/.ansible/collections:${DEBOPS_ANSIBLE_COLLECTIONS_PATH}:/usr/share/ansible/collections") }}'

        # Don't show tasks that were skipped during Ansible execution.
        display_skipped_hosts: {{ env["ANSIBLE_DISPLAY_SKIPPED_HOSTS"] | d("false") }}

        # In case of failure, Ansible creates the '<playbook>.retry' files beside the
        # playbook which contain names of hosts that failed. This is useless with
        # DebOps since playbooks are in a central location therefore it will be
        # disabled by default.
        retry_files_enabled: {{ env["ANSIBLE_RETRY_FILES_ENABLED"] | d("false") }}

        # Make the default output of 'ansible-playbook' easier to read by a human.
        stdout_callback: '{{ env["ANSIBLE_STDOUT_CALLBACK"] | d("yaml") }}'

        # Define the list of the built-in callback plugins enabled by default.
        callbacks_enabled: '{{ env["ANSIBLE_CALLBACKS_ENABLED"] | d("timer") }}'

        # Enable or disable support for for connection pipelining. This has
        # implications for 'become' operations - the 'requiretty' option in
        # /etc/suders must be disabled for pipelining to work correctly.
        pipelining: {{ env["ANSIBLE_PIPELINING"] | d('false') }}

      diff:

        # If enabled, Ansible modules will always show differences when their
        # state has changed. Equivalent to adding '--diff' option on the
        # command line on each execution.
        always: {{ env["ANSIBLE_DIFF_ALWAYS"] | d("false") }}

      inventory:

        # This option disables the warnings about missing Ansible inventory groups
        # defined in a playbook. This warning message is very common in DebOps
        # playbooks and disabling it is recommended.
        host_pattern_mismatch: '{{ env["ANSIBLE_HOST_PATTERN_MISMATCH"] | d("ignore") }}'

      privilege_escalation:

        # Tell Ansible to always ask for the '--become' password. This might be
        # useful in environments where "sudo" password is required on each
        # execution.
        become_ask_pass: {{ env["ANSIBLE_BECOME_ASK_PASS"] | d("false") }}
