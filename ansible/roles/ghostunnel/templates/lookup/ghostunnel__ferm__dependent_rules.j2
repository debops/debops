{# Copyright (C) 2021 Pedro Luis Lopez <pedroluis.lopezsanchez@gmail.com>
 # Copyright (C) 2021 DebOps <https://debops.org/>
 # SPDX-License-Identifier: GPL-3.0-only
 #}
{% set ghostunnel__tpl_ferm = [] %}
{% for service in ghostunnel__combined_services %}
{%   if service.mode == 'server' %}
{%     set _ = ghostunnel__tpl_ferm.append({
   'name': 'ghostunnel_' + service.name|replace('-','_'),
   'type': 'accept',
   'dport': service.listen.split(":")[1]|string,
   'saddr': service.allow|d([]),
   'accept_any': not service.disable_authentication|d(False)|bool,
   'role': 'ghostunnel'
}) %}
{%   endif %}
{% endfor %}
{{ ghostunnel__tpl_ferm }}