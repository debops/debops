# Copyright (C) 2020 Pedro Luis Lopez <pedroluis.lopezsanchez@gmail.com>
# Copyright (C) 2020 DebOps <https://debops.org/>
# SPDX-License-Identifier: GPL-3.0-or-later

# {{ ansible_managed }}

{% set prometheus_exporter__tpl_ghostunnel_args = [] %}
{% set _ = prometheus_exporter__tpl_ghostunnel_args.append('--{} {}'.format('listen', ('0.0.0.0' if not prometheus_exporter__bind|d(False) else prometheus_exporter__bind) + ':' + item.public_port|string)) %}
{% set _ = prometheus_exporter__tpl_ghostunnel_args.append('--{} {}'.format('target', 'localhost:' + item.private_port|string)) %}
{% set _ = prometheus_exporter__tpl_ghostunnel_args.append('--{} {}'.format('allow-cn', prometheus_exporter__server)) %}
ARGS="{{ prometheus_exporter__tpl_ghostunnel_args | join(' ') }}"
CERT_PATH="{{ prometheus_exporter__pki_path + "/" + prometheus_exporter__pki_realm + "/" + prometheus_exporter__pki_crt }}"
KEY_PATH="{{ prometheus_exporter__pki_path + "/" + prometheus_exporter__pki_realm + "/" + prometheus_exporter__pki_key }}"
CACERT_PATH="{{ prometheus_exporter__pki_path + "/" + prometheus_exporter__pki_realm + "/" + prometheus_exporter__pki_ca }}"
