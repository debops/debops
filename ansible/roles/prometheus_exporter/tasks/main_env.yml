---
# Copyright (C) 2020 Pedro Luis Lopez <pedroluis.lopezsanchez@gmail.com>
# Copyright (C) 2020 DebOps <https://debops.org/>
# SPDX-License-Identifier: GPL-3.0-or-later

- name: Create Prometheus system group
  group:
    name: 'prometheus'
    state: 'present'
    system: True

- name: Create Prometheus system user
  user:
    name: 'prometheus'
    group: 'prometheus'
    groups: '{{ prometheus_exporter__combined_append_groups | join(",") | default(omit) }}'
    home: '/var/lib/prometheus'
    comment: 'Prometheus daemon,,,'
    shell: '/bin/false'
    state: 'present'
    system: True

- name: Set dependent variables with role templates and roles precedence
  set_fact:
    prometheus_exporter__etc_services__dependent_list_env: '{{ prometheus_exporter__etc_services__dependent_list }}'
    prometheus_exporter__ferm__dependent_rules_env: '{{ prometheus_exporter__ferm__dependent_rules }}'
