---

- name: Install requested APT packages
  apt:
    name: '{{ item }}'
    state: 'present'
    install_recommends: False
  with_flattened: '{{ python__combined_packages }}'
  when: python__enabled|bool and ansible_pkg_mgr == 'apt'

- name: Install requested packages
  package:
    name: '{{ item }}'
    state: 'present'
  with_flattened: '{{ python__combined_packages }}'
  when: python__enabled|bool and ansible_pkg_mgr != 'apt'

- name: Configure local facts
  import_tasks: local_facts.yml

- name: Re-read local facts if they have been modified
  action: setup
  when: local_facts__register_facts is changed
