---
# Copyright (C) 2021 Dr. Serge Victor <https://dr.sergevictor.eu/>
# Copyright (C) 2021 DebOps <https://debops.org/>
# SPDX-License-Identifier: GPL-3.0-or-later

- name: Check telegraf and restart
  ansible.builtin.command: '/usr/bin/telegraf --test --config /etc/telegraf/telegraf.conf --config-directory /etc/telegraf/telegraf.d'
  register: global_handlers__telegraf_register_config_test
  changed_when: global_handlers__telegraf_register_config_test.changed | bool
  notify: [ 'Restart telegraf' ]

- name: Restart telegraf
  ansible.builtin.service:
    name: "telegraf"
    state: "restarted"
