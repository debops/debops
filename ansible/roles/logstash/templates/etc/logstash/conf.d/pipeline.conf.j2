{# Copyright (C) 2020 Pedro Luis Lopez <pedroluis.lopezsanchez@gmail.com>
 # Copyright (C) 2020 DebOps <https://debops.org/>
 # SPDX-License-Identifier: GPL-3.0-only
 #}
# {{ ansible_managed }}

{% for stage in item.stages %}
{%   if stage.sections %}
{{ stage.name }} {
{%     for section in stage.sections %}
{%       if section.if_expression is defined %}
  if {{ section.if_expression }} {
{%       endif %}
{%       for plugin in section.plugins %}
{%         if plugin.if_expression is defined %}
    if {{ plugin.if_expression }} {
{%         endif %}
      {{ plugin.name }} {
{%         if plugin.settings is defined %}
{%           for setting in plugin.settings %}
{%             for k, v in setting.items() %}
{%               if v %}
        {{ k + " => " + v|to_json }}
{%               endif %}
{%             endfor %}
{%           endfor %}
{%         endif %}
      }
{%         if plugin.if_expression is defined %}
    }
{%         endif %}

{%       endfor %}
{%       if section.if_expression is defined %}
  }
{%       endif %}
{%     endfor %}
}

{%   endif %}
{% endfor %}
