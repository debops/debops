{#
#    ---- apt_preferences pin template ----
#
# Variables used in this template:
#
#   - item.package: ''
#       Required variable.
#       String of package names affected by this pin, each package separated by
#       space. You can use 'package-*' wildcard to specify multiple packages.
#       First package name will be included in automatically generated filename
#       of the pin preferences file.
#
#   - item.backports: []
#       List of OS releases which should be considered when apt_preferences
#       role configures pin for a backported package. If current OS release is
#       not on this list, pin won't be created, and existing pin will be
#       removed. This should allow for easy transition to next OS release.
#
#   - item.version: ''
#       Specify a particular package version you want to pin, for exmple
#       '5.10'. It will be configured with added '*' at the end to allow for
#       upgrades.
#       By default versioned pins are set with priority 1001, which
#       should ensure that selected pckage version is never upgraded, or it
#       will be downgraded if required.
#
#   - item.priority: ''
#       Specify custom priority for a pin. By default pins are created with
#       priority 500 to allow for easy installation of packages from backports,
#       versioned pins are created with priority 1001.
#
#   - item.reason: ''
#       A short description explaining the reason for a pin. Might be used to
#       point a system administrator to useful documentation explaining why
#       a particular pin is defined.
#
#   - item.filename: ''
#       Name of the generated file with pin preferences, saved in
#       /etc/apt/preferences.d/. If undefined, 'apt_preferences' role will
#       automatically generate a filename.
#
#   - item.suffix: ''
#       Additional string added at the end of autogenerated filename, can be
#       used to prevent filename collisions.
#
#   - item.by_role: ''
#       Name of a role which sets a particular pin. This name will be included
#       in the autogenerated filename.
#
#   - item.pin: ''
#       Custom pin definition. If this variable is undefined, 'apt_preferences'
#       role will automatically configure selected packages with preference for
#       a backported version.
#
#   - item.raw: |
#       Instead of generating a pin automatically, use contents of this text
#       block for pin configuration. Might be used to create several pins in
#       one file.
#
#   - item.delete: True
#       If this variable is defined, preferences file for this pin will be
#       deleted and new one will not be created.
#
#}
{% if item.raw is undefined %}
{% if item.by_role is defined and item.by_role %}
Explanation: Pin added by role: {{ item.by_role }}
{% endif %}
Explanation: {{ item.reason | default('Reason not specified') }}
Package: {{ item.package }}
{% if item.version is defined and item.version %}
Pin: version {{ item.version + '*' }}
Pin-Priority: {{ item.priority | default(apt_preferences_priority_version) }}
{% else %}
Pin: {{ item.pin | default('release a=' + ansible_distribution_release + '-backports') }}
Pin-Priority: {{ item.priority | default(apt_preferences_priority_default) }}
{% endif %}
{% elif item.raw is defined and item.raw %}
{{ item.raw }}
{% endif %}

